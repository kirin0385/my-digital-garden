/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var b=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var A=(l,o)=>{for(var e in o)b(l,e,{get:o[e],enumerable:!0})},N=(l,o,e,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of D(o))!I.call(l,s)&&s!==e&&b(l,s,{get:()=>o[s],enumerable:!(t=$(o,s))||t.enumerable});return l};var O=l=>N(b({},"__esModule",{value:!0}),l);var L={};A(L,{default:()=>S});module.exports=O(L);var i=require("obsidian"),M=new Set(["is","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now"]),z=new Set(["\uB294","\uC744","\uB97C","\uC5D0\uC11C","\uC73C\uB85C","\uBFD0","\uADF8\uB9AC\uACE0","\uADF8\uB798\uC11C","\uADF8\uB7EC\uB098","\uD558\uC9C0\uB9CC","\uADF8\uB7F0\uB370","\uB4F1","\uBC0F","\uC800","\uAC83","\uB54C","\uACF3"]),E=new Set([...M,...z]),P={foldersToIgnore:[],maxResults:25,minScore:.1},S=class extends i.Plugin{constructor(){super(...arguments);this.isSearching=!1}async onload(){await this.loadSettings(),this.addRibbonIcon("link","Find similar notes",()=>{var t;let e=(t=this.app.workspace.activeEditor)==null?void 0:t.editor;if(e){let s=e.getSelection();s.trim()!==""?this.findAndShowSimilarContent(s,e):new i.Notice("Please select text first to find similar notes.")}else new i.Notice("Please open a note and select text first.")}),this.addCommand({id:"find-similar-content",name:"Find similar content for selection",editorCallback:(e,t)=>{let s=e.getSelection();s.trim()!==""?this.findAndShowSimilarContent(s,e):new i.Notice("Please select text to find similar content.")}}),this.addSettingTab(new v(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},P,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async findAndShowSimilarContent(e,t){if(this.isSearching){new i.Notice("A search is already in progress. Please wait.");return}this.isSearching=!0;let s=null,a=setTimeout(()=>{s=new i.Notice(`Searching for content similar to "${e.trim()}"...`,0)},500);try{let c=e.trim();if(c.length<2){new i.Notice("Please select at least 2 characters.");return}let f=new Set(c.toLowerCase().split(/\s+/).filter(r=>r.length>0&&!E.has(r)));if(f.size===0){new i.Notice("Query contains only common words. Please try a more specific query.");return}let k=this.app.vault.getMarkdownFiles(),y=[],C=this.app.workspace.getActiveFile(),R=new Set(this.settings.foldersToIgnore);for(let r of k){if(C&&r.path===C.path||R.size>0&&Array.from(R).some(n=>r.path.startsWith(n)))continue;let h=this.app.metadataCache.getFileCache(r);if(!h)continue;let w=await this.app.vault.cachedRead(r),d=(n,u,g)=>{let T=new Set(n.toLowerCase().split(/\s+/).filter(m=>!E.has(m))),p=0;for(let m of f)T.has(m)&&p++;if(p>0){let m=p/f.size,F=u==="heading"?`[H] ${n}`:`[P] ${n.substring(0,100).trim()}`;y.push({file:r,content:n,displayText:F,type:u,linkTarget:g,score:m})}};if(h.headings)for(let n of h.headings)d(n.heading,"heading",n.heading);if(h.sections)for(let n of h.sections){if(n.type==="heading")continue;let u=w.substring(n.position.start.offset,n.position.end.offset);if(u.trim().length>0){let g;if(h.blocks){for(let p in h.blocks)if(h.blocks[p].position.start.line===n.position.start.line){g=p;break}}let T=g?`^${g}`:u.split(`
`)[0];d(u,"block",T)}}}if(y.length>0){let r=y.filter(d=>d.score>=this.settings.minScore);r.sort((d,n)=>n.score-d.score);let w=r.filter((d,n,u)=>n===u.findIndex(g=>g.file.path===d.file.path&&g.content===d.content)).slice(0,this.settings.maxResults);w.length>0?new x(this.app,w,t,e).open():new i.Notice("No results matched your filter settings. Try adjusting them in the plugin settings.")}else new i.Notice("No similar content found.")}catch(c){console.error("Error during similar content search:",c),new i.Notice("An unexpected error occurred. Please check the developer console for details.")}finally{clearTimeout(a),s&&s.hide(),this.isSearching=!1}}},x=class extends i.FuzzySuggestModal{constructor(e,t,s,a){super(e);this.results=t;this.editor=s;this.originalSelection=a}getItems(){return this.results}onChooseItem(e,t){let s=t.ctrlKey||t.metaKey,a=this.app.metadataCache.fileToLinktext(e.file,"",!0),c=a;if(e.type==="heading"?c=`${a}#${e.linkTarget}`:e.type==="block"&&e.linkTarget.startsWith("^")&&(c=`${a}#${e.linkTarget}`),s)this.app.workspace.openLinkText(c,e.file.path,!0),new i.Notice(`Opened "${e.file.basename}" in a new tab.`);else{let f=`[[${c}|${this.originalSelection}]]`;this.editor.replaceSelection(f),new i.Notice(`Link to "${e.file.basename}" inserted.`)}}renderSuggestion(e,t){t.empty(),t.addClass("similar-notes-result-item");let s=t.createDiv({cls:"suggestion-content"});s.createDiv({text:e.item.type==="heading"?"H":"P",cls:"suggestion-type-icon"});let a=e.item.displayText.substring(e.item.displayText.indexOf("]")+2);s.createDiv({text:a,cls:"suggestion-main-text"});let f=`${(e.item.score*100).toFixed(0)}%`;s.createDiv({text:f,cls:"suggestion-score-badge"}),t.createDiv({cls:"suggestion-aux"}).createEl("span",{text:e.item.file.path,cls:"suggestion-file-path"})}getItemText(e){return`${e.file.basename} ${e.displayText}`}},v=class extends i.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new i.Setting(e).setName("Folders to ignore").addTextArea(t=>t.setPlaceholder(`Templates/
Attachments/`).setValue(this.plugin.settings.foldersToIgnore.join(`
`)).onChange(async s=>{this.plugin.settings.foldersToIgnore=s.split(`
`).map(a=>a.trim()).filter(a=>a.length>0),await this.plugin.saveSettings()})),new i.Setting(e).setName("Maximum results").addSlider(t=>t.setLimits(5,100,5).setValue(this.plugin.settings.maxResults).setDynamicTooltip().onChange(async s=>{this.plugin.settings.maxResults=s,await this.plugin.saveSettings()})),new i.Setting(e).setName("Minimum score threshold").setDesc("Only show results with a similarity score above this value.").addExtraButton(t=>{t.setIcon("reset").setTooltip("Reset to default").onClick(async()=>{this.plugin.settings.minScore=P.minScore,await this.plugin.saveSettings(),this.display()})}).addSlider(t=>{t.setLimits(0,100,1).setValue(this.plugin.settings.minScore*100).setDynamicTooltip().onChange(async s=>{this.plugin.settings.minScore=s/100,await this.plugin.saveSettings()})})}};

/* nosourcemap */